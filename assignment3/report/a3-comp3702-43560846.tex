\title{COMP3702 - Assignment 3}
\author{Roy Portas - 43560846}
\date{\today}

\documentclass[12pt]{article}
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{geometry}
\usepackage{listings}
\usepackage{verbatim}
\geometry{
    a4paper,
    margin=1in
}

\begin{document}
    \maketitle

    \section{Question 1: Problem Definition}

    \subsection{State Space}
    The state space will be a set of tuples of integers from 0 to the maximum number of items the shop can stock. The size of the tuple is the number of items a shop can stock. 
    Thus for a tiny store it will be $\left\{(0, 0), (0, 1), (1, 0), \ldots, (3, 0), (0, 3)\right\}$. Note the sum of the elements in the tuple must be less than or equal to the number of items a store can stock.

    \subsection{Action Space}
    The actions space will be the set of all actions that can be performed by the customers. 
    Thus for a tiny store, it will look like the following:

    \begin{verbatim}
        {
            (buy 0 of item 1, buy 0 of item 2),
            (buy 1 of item 1, buy 0 of item 2),
            ...,
            (buy 2 of item 1, buy 1 of item 2),
            (buy 3 of item 1, buy 0 of item 2)
        }
    \end{verbatim}

    Note that returning an item is represented as buying a negative number of items.

    \subsection{Transition Function}

    The transitions of items are indepedant from each other, meaning that buying one item type does not influence the probability of buying another item type. Thus the transition function for a tiny store can be represented as follows:

    \begin{align*}
        T((i_1, i_2), (t_1, t_2), i_1', i_2') = T_{i_1}(i_1, t_1, i_1) \cdot T_{i_2}(i_2, t_2, i_2)
    \end{align*}

    The transition function will be a matrix for each item type where the rows and columns are the number of items the store stocks.

    \begin{center}
        \begin{tabular} {|c|c|c|c|c|}
            \hline
            Item 1 & 0 & 1 & 2 & 3 \\
            \hline
            0 & 0.2    & 0.3    & 0.2    & 0.3 \\
            1 & 0.4    & 0.1    & 0.2    & 0.3 \\
            2 & 0.1    & 0.5    & 0.2    & 0.2 \\
            3 & 0      & 0.8    & 0.2    & 0   \\
            \hline
        \end{tabular}
    \end{center}

    \begin{center}
        \begin{tabular} {|c|c|c|c|c|}
            \hline
            Item 2 & 0 & 1 & 2 & 3 \\
            \hline
            0 & 0.4    & 0.1    & 0.2    & 0.3 \\
            1 & 0.2    & 0.3    & 0.2    & 0.3 \\
            2 & 0.1    & 0.5    & 0.2    & 0.2 \\
            3 & 0.1    & 0.9  & 0    & 0       \\
            \hline
        \end{tabular}
    \end{center}

    In this table, the rows represent the current state and the columns represent the next state.

    \subsection{Reward Function}

    The reward function will be the net profit made by the store after performing an action. As with the transition function, the reward for one item type is independant to the reward of other item types.

    \subsection{Discount Factor}

    The discount factor is given in the input file.

    \subsection{Value Function}

    A value function associates a state with the value, or 'worth' of being in that state.

    \begin{align*}
        V_{\pi}(s) = \sum_{s'} T(s, \pi(s), s') \big[ R(s, \pi(s) s') + dV_{\pi}(s') \big]
    \end{align*}

    However since the reward is independant from the next state, the reward function can be represented as $R(s, a)$, yielding:

    \begin{align*}
        V_{\pi}(s) = R(s, \pi(s)) + d\sum_{s'}T(s, \pi{s}, s') V_{\pi}(s')
    \end{align*}

    \subsubsection{Calculating the value function}

    \begin{verbatim}
        def value(action):
            # Calculate the expected number of items sold
            prob = action * transition

            # Calculate the net profit of the transactions
            profit = prob * item_prices
    \end{verbatim}

    Where action is the tuple containing the the number of items.

    \section{Question 2: Algorithm Description}

    \subsection{Offline Implementation}
        \begin{enumerate}
            \item Generate every possible action the customer can take and put it into an array, calculating the cost of any returns done
            \item Run each array through the value function to calculate the profit for the action
            \item For each result in the result list, repeat step 1 with the new result as the new root node
            \item Break the loop when the number of weeks is reached
            \item Find the highest profit node and backtrack up the tree to find the order to make
        \end{enumerate}

    \subsection{Online Implementation}

    The online method will involve getting the current store stock at a given week and calculating the best outcome based on the given probabilities. It will do this by using the value function to calculate the profit for every possible outcome.

    \begin{enumerate}
        \item Get the current stock of the store
        \item Using the current stock, find every possible combination of returning and buying items
        \item Apply the value function to every combination
        \item Select the state with the highest profit
    \end{enumerate}

    \section{Question 3: Algorithm Analysis}

    The two algorithms to compare are the Monte Carlo search tree, which was used for the offline implementation, and the base value iteration method, which was used for the online implementation.

    The two algorithms can be compared based on running time and profit generated, these are shown in the tables below.

    \begin{table}
        \centering
        \begin{tabular}{ |c|c|c| }
            \hline
            Run & Running time & Profit \\
            \hline
            1 & 8ms & \$1349.56\\
            \hline
        \end{tabular}

        \caption{Small Store, Base Value Interation Method}
    \end{table}

\end{document}
